name: build_project

env:
  BUILD_PROJECT: "SpaceShooter2"

runs:
  using: "composite"
  steps:
    - name: setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 6.0.x

    - name: restore dependencies
      run: dotnet restore "$BUILD_PROJECT"

    - name: build release
      run: dotnet build "$BUILD_PROJECT" --no-restore --configuration Release

    - name: run tests test
      run: dotnet test "$BUILD_PROJECT" --no-build --verbosity normal

    - name: compress build files
      run: zip "$BUILD_PROJECT_win-64.zip" "$BUILD_PROJECT/bin/Release/net6.0/*" -r

    - name: upload release assets
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ github.event.release.tag_name }}
        files: "./$BUILD_PROJECT_win-64.zip"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
